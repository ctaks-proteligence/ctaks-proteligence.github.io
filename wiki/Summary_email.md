# Summary email

This page contains information regarding the ETL Summary email.

# General Contents

The summary email is generated by the ETL process based on settings
defined in the dn3.properties file. It consists of four sections:

- Latest Data Gaps Detected - This section indicates gaps in the data
  files that have been successfully loaded. **NOTE: This section is new
  and needs to be added.**
- Files Out of Date - The section indicates what is out-of-date. It
  lists the regions/types that are older than 24 hours based on the
  data-end timestamp for the last successfully processed file.
- Files Not Received - The section indicates what regions/types haven't
  received the current day's file based on the current date and the
  data-end timestamp in the latest file received (the file may not have
  been processed yet but must be detected by ETL or it will be flagged
  here).
- Files Received - The section indicates the status of what was received
  recently. By default, it picks up the last 24 hours. This may show
  files that have been validated but not yet processed, what has been
  processed, what has failed validation or failed to process, etc.

# Section Details

## Latest Data Gaps Detected

The details of the Latest Data Gaps Detected are as follows:

- the Latest Load Gaps Detected section should be the first section of
  the summary email
- check and report by Master Station Code, Process ID, and Fact Record
  Type (B2, SFI, SFP, DF, RF, and AS)
- the report should be based on successfully loaded files only (STATUS =
  'PROCESSING_SUCCESS')
- ignore files with EXTRACT_TYPE = 'G' (Gap) or 'I' (Initial)
- only the latest gap for each MSC/PID/Fact Record Type should be
  reported
- a gap for the purposes of this report is defined as \[Data Start of
  the next file\] \> \[Data End of the previous file + 1 microsecond\]
  and is the same for B2 and ITS data
- the gap report should include:
  - MSC - Master Station Code
  - PID - Process ID
  - Fact Record Type
  - Gap Start - the expected Data Start to fill the gap
  - Gap End - the expected Data End to fill the gap
- the report should be sorted by Gap Start, MSC, PID, Fact Record Type
  such that the oldest gaps are at the top of the list
- suggested query: SELECT DISTINCT MASTER_STATION_CD, PROCESS_ID,
  FACT_RECORD_TYPE, DATA_START, DATA_END FROM DNT_IPDS_EXTRACT_FILE_INFO
  WHERE STATUS = 'PROCESSING_SUCCESS' AND EXTRACT_TYPE \<\> 'G' AND
  EXTRACT_TYPE \<\> 'I' ORDER BY MASTER_STATION_CD, PROCESS_ID,
  FACT_RECORD_TYPE, DATA_START, DATA_END;
- files included in other files or that overlap should not be considered
  gaps as long as no gap exists when looking at all files; for example:
  - A rerun that picks up additional data compared to the previous file:
    - 2016-05-29 00:00:06.282484 2016-05-31 00:53:44.303152
    - 2016-05-31 00:53:44.303153 2016-06-01 00:01:35.251325 - same start
      time as next file but this one ends earlier - no gap
    - 2016-05-31 00:53:44.303153 2016-06-02 00:00:07.824437 - same start
      time as previous file but this one ends later - no gap
    - 2016-06-02 00:00:07.824438 2016-06-03 00:00:03.363164
  - A subsequent file that starts before the previous file ended:
    - 2016-05-29 00:00:06.282484 2016-05-31 00:53:44.303152
    - 2016-05-31 00:52:44.303153 2016-06-01 00:01:35.251325 - file
      starts befor previous file ends - no gap
  - A rerun that picks up additional data compared to the previous file
    and the next file follows after the earlier file:
    - 2016-05-29 00:00:06.282484 2016-06-02 12:00:00.000000
    - 2016-05-30 00:53:44.303153 2016-06-03 00:00:00.000000 - this file
      has some overlapping data but is fine
    - 2016-06-02 12:00:00.000001 2016-06-03 00:00:03.363164
  - A file completely included in another file:
    - 2016-05-29 00:00:06.282484 2016-06-02 12:00:00.000000
    - 2016-05-30 00:53:44.303153 2016-06-01 00:00:00.000000 - this file
      is complety included in the previous file

## Files Out of Date

The details for this section need to be added.

## Files Not Received

The details for this section need to be added.

## Files Received

The details for this section need to be added.
